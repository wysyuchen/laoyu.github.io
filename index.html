<script>
    const sites = {
        "国家大学生就业服务平台": "https://www.ncss.cn",
        "高校人才网": "http://www.gaoxiaojob.com",
        "智联招聘": "https://www.zhaopin.com",
        "前程无忧": "https://www.51job.com",
        "BOSS直聘": "https://www.zhipin.com"
    };

    // 使用 CORS 代理
    const proxy = "https://cors-anywhere.herokuapp.com/";

    async function fetchJobs(siteName, siteUrl) {
        try {
            const response = await fetch(proxy + siteUrl);
            if (!response.ok) {
                throw new Error(`Failed to fetch ${siteName}`);
            }

            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, "text/html");

            let jobList = [];
            
            doc.querySelectorAll('a').forEach((link, index) => {
                if (index < 5) {
                    jobList.push({
                        title: link.textContent.trim(),
                        link: link.href.startsWith('http') ? link.href : siteUrl + link.getAttribute('href')
                    });
                }
            });

            return { siteName, jobList };
        } catch (error) {
            console.error(error);
            return { siteName, jobList: [] };
        }
    }

    async function loadJobs() {
        const jobListDiv = document.getElementById("job-list");
        jobListDiv.innerHTML = "<p>加载中...</p>";

        const fetchPromises = Object.entries(sites).map(([name, url]) => fetchJobs(name, url));
        const results = await Promise.all(fetchPromises);

        jobListDiv.innerHTML = "";
        results.forEach(({ siteName, jobList }) => {
            const siteDiv = document.createElement("div");
            siteDiv.className = "site-section";
            siteDiv.innerHTML = `<h2>${siteName}</h2>`;

            if (jobList.length === 0) {
                siteDiv.innerHTML += `<p>未能加载数据</p>`;
            } else {
                jobList.forEach(job => {
                    siteDiv.innerHTML += `
                        <div class="job">
                            <a href="${job.link}" target="_blank">${job.title}</a>
                        </div>
                    `;
                });
            }

            jobListDiv.appendChild(siteDiv);
        });
    }

    loadJobs();
</script>
